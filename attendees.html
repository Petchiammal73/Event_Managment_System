{% extends 'base.html' %}
{% block content %}
<h2>Attendees List</h2>
<br>
<a href="{{ url_for('register_attendee') }}" class="btn btn-primary" style="margin-bottom:15px;">Register New Attendee</a>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Event</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for attendee in attendees %}
    <tr>
      <td>{{ attendee.name }}</td>
      <td>{{ attendee.email }}</td>
      <td>{{ attendee.event_title }}</td>
      <td>
        <a href="{{ url_for('edit_attendee', attendee_id=attendee.id) }}" class="btn btn-primary btn-sm">✏️ Edit</a>
        <a href="{{ url_for('delete_attendee', attendee_id=attendee.id) }}" class="btn btn-danger btn-sm" onclick="return confirm('Delete this attendee?')">🗑️ Delete</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h2>Attendees by Event</h2>
<div class="attendees-by-event">
  {% for event in attendees|groupby('event_title') %}
    <div class="event-toggle-block">
      <button class="btn btn-secondary toggle-btn" onclick="toggleEvent('{{ event.grouper }}')">
        Show Attendees for {{ event.grouper }}
      </button>
      <div id="event-{{ event.grouper }}" class="event-attendees-table" style="display:none;">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody>
            {% for attendee in event.list %}
            <tr>
              <td>{{ attendee.name }}</td>
              <td>{{ attendee.email }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endfor %}
</div>

<script>
function toggleEvent(eventName) {
  const div = document.getElementById('event-' + eventName);
  div.style.display = div.style.display === 'none' ? 'block' : 'none';
}
</script>
{% endblock %}
